{"version":3,"sources":["webpack:////Users/bingyi/Documents/HBuilderProjects/Telecom/main.js","webpack:////Users/bingyi/Documents/HBuilderProjects/Telecom/pages/telecom/Authorization.vue","webpack:////Users/bingyi/Documents/HBuilderProjects/Telecom/pages/telecom/Authorization.vue?6998","webpack:////Users/bingyi/Documents/HBuilderProjects/Telecom/pages/telecom/Authorization.vue?c2b6","webpack:////Users/bingyi/Documents/HBuilderProjects/Telecom/pages/telecom/Authorization.vue?1c39","webpack:///../../../../../../Users/bingyi/Documents/HBuilderProjects/Telecom/pages/telecom/Authorization.vue","webpack:////Users/bingyi/Documents/HBuilderProjects/Telecom/common/Authorization.js","webpack:////Users/bingyi/Documents/HBuilderProjects/Telecom/common/user.js"],"names":["Page","App","wx","login","_this","uni","showLoading","title","provider","success","loginRes","code","userApi","authorization","wxLogon","orgId","store","state","appName","then","result","openId","unionid","hideLoading","getUserInfo","withCredentials","infoRes","nickName","userInfo","avatarUrl","getWxUserInfo","sessionKey","rawData","signature","encryptedData","iv","result2","commit","token","username","isLogin","navigateTo","url","fail","res","showModal","content","catch","e","console","log","serviceId","user","getById","id","serviceAPI","request","method","data","getByToken","params"],"mappings":"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","file":"pages/telecom/Authorization.js","sourcesContent":["import 'uni-pages';\nimport pageFactory from 'mpvue-page-factory'\n    import App from './pages/telecom/Authorization.vue'\n    Page(pageFactory(App))","import { render, staticRenderFns } from \"./Authorization.vue?vue&type=template&id=f59bc5a6&name=index&\"\nimport script from \"./Authorization.vue?vue&type=script&lang=js&\"\nexport * from \"./Authorization.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!module.hot.data) {\n      api.createRecord('f59bc5a6', component.options)\n    } else {\n      api.reload('f59bc5a6', component.options)\n    }\n    module.hot.accept(\"./Authorization.vue?vue&type=template&id=f59bc5a6&name=index&\", function () {\n      api.rerender('f59bc5a6', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"Users/bingyi/Documents/HBuilderProjects/Telecom/pages/telecom/Authorization.vue\"\nexport default component.exports","export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./Authorization.vue?vue&type=template&id=f59bc5a6&name=index&\"","var render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _c(\n    \"view\",\n    [\n      _c(\n        \"cu-custom\",\n        { attrs: { bgColor: \"bg-gradual-blue\", mpcomid: \"bc9a25a2-0\" } },\n        [_c(\"block\", { slot: \"content\" }, [_vm._v(\"登录授权\")])],\n        1\n      ),\n      _vm._m(0),\n      _c(\n        \"view\",\n        { staticClass: \"padding  bg-white flex flex-direction\" },\n        [\n          _c(\n            \"button\",\n            {\n              staticClass: \"cu-btn bg-blue margin-tb-sm lg\",\n              attrs: {\n                \"open-type\": \"getUserInfo\",\n                withCredentials: \"true\",\n                lang: \"zh_CN\",\n                eventid: \"bc9a25a2-0\"\n              },\n              on: { getuserinfo: _vm.login }\n            },\n            [_vm._v(\"授权登录\")]\n          )\n        ],\n        1\n      )\n    ],\n    1\n  )\n}\nvar staticRenderFns = [\n  function() {\n    var _vm = this\n    var _h = _vm.$createElement\n    var _c = _vm._self._c || _h\n    return _c(\"view\", { staticClass: \"cu-bar bg-white margin-top\" }, [\n      _c(\"view\", { staticClass: \"action\" }, [\n        _vm._v(\"小程序需要获取头像、昵称\")\n      ])\n    ])\n  }\n]\nrender._withStripped = true\n\nexport { render, staticRenderFns }","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--18-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./Authorization.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--18-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./Authorization.vue?vue&type=script&lang=js&\"","<template name=\"index\">\n\t<view>\n\t\t\n\t\t<cu-custom bgColor=\"bg-gradual-blue\">\n\t\t\t<block slot=\"content\">登录授权</block>\n\t\t</cu-custom>\n\t\t<view class=\"cu-bar bg-white margin-top\">\n\t\t\t<view class=\"action\">\n\t\t\t\t小程序需要获取头像、昵称\n\t\t\t</view>\n\t\t</view>\n\t\t<view class=\"padding  bg-white flex flex-direction\">\n\t\t\t<button class=\"cu-btn bg-blue margin-tb-sm lg\" open-type=\"getUserInfo\" withCredentials=\"true\" lang=\"zh_CN\" @getuserinfo=\"login\">\n\t\t\t\t授权登录\n\t\t\t</button>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n\timport Authorization from \"@/common/Authorization\"\n\texport default {\n\t\tdata() {\n\t\t},\n\t\tmethods: {\n\t　　　　　//登录\n\t\t\tlogin() {\n\t\t\t\tAuthorization.wx.login()\n\t\t\t}\n\t\t\t\n\t\t}\n\t}\n</script>\n\n<style>\n</style>\n","import userApi from \"./user\"\nimport store from '@/store'\n\nexport default {\n\twx:{\n\t\tlogin() {\n\t\t\tlet _this = this;\n\t\t\tuni.showLoading({\n\t\t\t\ttitle: '登录中...'\n\t\t\t});\n\t\t \n\t\t   // 1.wx获取登录用户code\n\t\t\tuni.login({\n\t\t\t\tprovider: 'weixin',\n\t\t\t\tsuccess: function(loginRes) {\n\t\t\t\t\tlet code = loginRes.code;\n\t\t\t\t\t// console.log(code)\n\t\t\t\t\t// console.log(store.state.orgId)\n\t\t\t\t\tuserApi.authorization.wxLogon({code: code, orgId: store.state.orgId, appName: store.state.appName}).then(result => {\n\t\t\t\t\t\t//console.log(result)\n\t\t\t\t\t\t//先登录微信，拿到openId后，给用户提示登录成功\n\t\t\t\t\t\tlet openId = result.openId\n\t\t\t\t\t\tlet unionid = result.unionid\n\t\t\t\t\t\tif(!unionid && openId) {\n\t\t\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\t\t\tuni.showLoading({\n\t\t\t\t\t\t\t\ttitle: '初始化用户信息...'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t//微信需要登录成功后，才能根据信息拿到unionid\n\t\t\t\t\t\t\tuni.getUserInfo({\n\t\t\t\t\t\t\t\twithCredentials: true,\n\t\t\t\t\t\t\t\tsuccess: function(infoRes) {\n\t\t\t\t\t\t\t\t\tlet nickName = infoRes.userInfo.nickName; //昵称\n\t\t\t\t\t\t\t\t\tlet avatarUrl = infoRes.userInfo.avatarUrl; //头像\n\t\t\t\t\t\t\t\t\t//JSON.stringify()\n\t\t\t\t\t\t\t\t\t//通过拿到的用户信息，后台去找用户相关的unionid,同时，如果unionid在平台中不存在，那么初化一个用户并绑定到这个用户的unionid\n\t\t\t\t\t\t\t\t\tuserApi.authorization.getWxUserInfo({\n\t\t\t\t\t\t\t\t\t\tsessionKey: result.sessionKey ,\n\t\t\t\t\t\t\t\t\t\trawData: infoRes.rawData,\n\t\t\t\t\t\t\t\t\t\tsignature: infoRes.signature ,\n\t\t\t\t\t\t\t\t\t\tencryptedData: infoRes.encryptedData ,\n\t\t\t\t\t\t\t\t\t\tiv: infoRes.iv,\n\t\t\t\t\t\t\t\t\t\torgId: store.state.orgId, \n\t\t\t\t\t\t\t\t\t\tappName: store.state.appName\n\t\t\t\t\t\t\t\t\t}).then(result2 => {\n\t\t\t\t\t\t\t\t\t\tstore.commit(\"login\", {\n\t\t\t\t\t\t\t\t\t\t\tnickName: nickName,\n\t\t\t\t\t\t\t\t\t\t\tavatarUrl: avatarUrl,\n\t\t\t\t\t\t\t\t\t\t\ttoken: result2.token,\n\t\t\t\t\t\t\t\t\t\t\tusername: result2.username,\n\t\t\t\t\t\t\t\t\t\t\tisLogin: true\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\tuni.hideLoading()\n\t\t\t\t\t\t\t\t\t\t//console.log(store.state.token)\n\t\t\t\t\t\t\t\t\t\tuni.navigateTo({\n\t\t\t\t\t\t\t\t\t\t\turl: '/pages/telecom/index'\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t//console.log(result)\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tfail(res) {}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}else {\n\t\t\t\t\t\t\tuni.showModal({\n\t\t\t\t\t\t\t\ttitle: \"提示\",\n\t\t\t\t\t\t\t\tcontent: \"登录失败！\",\n\t\t\t\t\t\t\t\tsuccess: () => {\n\t\t\t\t\t\t\t\t\t//TODO: 退出小程序\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t}).catch(e => {\n\t\t\t\t\t\tconsole.log(e)\n\t\t\t\t\t})\n\t\t\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n}\n\t\t\t\t\n\t\t\t \n\t\t\t  \n\t\t\t\t","import serviceAPI from '@/common/serviceAPI'\n\nconst serviceId = '/MICROSERVICE-USER'\n\nexport default {\n\tuser: {\n\t    getById(id) {\n\t      return serviceAPI.request({\n\t        url: serviceId + '/user/getById/' + id,\n\t        method: 'get',\n\t        data: null\n\t      })\n\t    },\n\t\tgetByToken(token) {\n\t\t  return serviceAPI.request({\n\t\t\turl: serviceId + '/user/getByToken',\n\t\t\tmethod: 'get',\n\t\t\tdata: { token }\n\t\t  })\n\t\t}\n\t},\n\tauthorization: {\n\t\twxLogon(params) {\n\t\t\treturn serviceAPI.request({\n\t\t\t  url: serviceId + '/user/authorization/wxLogon',\n\t\t\t  method: 'get',\n\t\t\t  data: params\n\t\t\t})\n\t\t},\n\t\tgetWxUserInfo(params) {\n\t\t\treturn serviceAPI.request({\n\t\t\t  url: serviceId + '/user/authorization/getWxUserInfo',\n\t\t\t  method: 'get',\n\t\t\t  data: params\n\t\t\t})\n\t\t}\n\t}\n}"],"sourceRoot":""}